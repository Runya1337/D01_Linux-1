# Установка и обновления системы Linux. Основы администрирования

## Part 1. Установка ОС

Установил Ubuntu 20.04 Server LTS без графического интерфейса, используя программу для виртуализации - VirtualBox. После ввода команды `cat /etc/issue` в консоль вывелась версия операционной системы Ubuntu 20.04.6 LTS

![Image](img/1_check_versions.png)
<br><br><br>

## Part 2. Создание пользователя
Создаем пользователя с помощью команды `sudo adduser user`, который создавался при установке. Пользователь был добавлен в группу adm `sudo usermod -a -G adm new_user`. Ниже приложен скриншот вывода команды `cat /etc/passwd`:

![Image](img/2_create_user.png)
![Image](img/3_check_operations.png)
<br><br><br>

## Part 3. Настройка сети ОС

Задаем название машины вида user-1 с помощью команды `sudo hostnamectl set-hostname user-shmuser` и проверил с помощью команды `hostname`:

![Image](img/hostname.png)
<br><br><br>

Получаем ip адрес устройтва, с которого ведется работа.
![Image](img/13_hostname_i.png)
<br><br><br>

Установливаем временную зону, соответствующую нашему текущему местоположению с помощью команды `sudo timedatectl set-timezone Europe/Moscow` и провериваем с помощью команды `timedatectl`:

![Image](img/4_install_clock.png)
<br><br><br>

Выводим названия сетевых интерефейсов при помощи команды `ip link show`:

![Image](img/5_check_web.png)
<br><br><br>

Интерфейс lo это как "внутренний телефон" компьютера. Он позволяет компьютеру "звонить самому себе", отправлять сообщения внутри себя.

Вместо обычного адреса, как у большинства других вещей в интернете, у него всегда один и тот же адрес: 127.0.0.1. Это специальный адрес, который всегда указывает обратно на сам компьютер.
<br><br><br>

Введя `sudo dhclient -v enp0s3` получаем ip устройства от DHCP сервера и проверил полученный ip адрес с помощью команды `ip addr show enp0s3`:

![Image](img/6_check_ip.png)

DHCP - это Динамический протокол конфигурации хоста.

Этот протокол позволяет компьютерам автоматически получать настройки сети от сервера DHCP при подключении к сети. Настройки, которые компьютер может получить, включают IP-адрес, адреса DNS-серверов, маску подсети и многое другое.

<br><br><br>

Определяем и выводим на экран внешний ip-адрес шлюза и внутренний IP-адрес шлюза. `curl 2ip.ru; echo`:

![Image](img/7_check_2ip.png)
<br><br><br>

Задаем статичные настройки ip, gw, dns. Для этого переходим в папку `/etc/netplan/`, находим файл конфигурации сети `00-installer-config.yaml`. Через nano ставим в параметр `dhcp4`
 `no`, чтобы отключть автоматическое получение IP-адреса от DHCP. Добавляем новые
 параметры:
- addresses: - 10.0.2.10/24, тем самым установив внутренний статический IP-адрес;
- nameservers: addresses: [1.1.1.1], тем самым устанавливив публичный DNS-сервер.

![Image](img/8_nano_change.png)
![Image](img/9_settings_nano.png)

Затем мы применяем все изменени сети с помощью команды `sudo netplan apply`, для того, чтобы они сохранились даже после перезагрузки машины. После перезагрузки машины, с помощью команды `ip addr show enp0s3`, убеждаемся, что установленные настройки сохранились:

![Image](img/10_netplan.png)
<br><br><br>
![Image](img/11_show_enp0s3.png)
<br><br><br>

Пингуем удаленные хосты 1.1.1.1 и google.com с помощью команды `ping -c 4 <addr>` отчёт ниже, в котором видно фразу "0% packet loss":

![Image](img/14_ping.png)
<br><br><br>


## Part 4. Обновление ОС

Обновляем системные пакеты до последней на момент выполнения задания версии с помощью команд `sudo apt-get update` и `sudo apt-get upgrade`. Также, после обновления системных пакетов, вводим команду обновления повторно, и как водно из скриншота ниже, новые обновления отсутствуют:

![Image](img/15_update_os.png)
<br><br><br>

## Part 5. Использование команды sudo

>**sudo** - консольная команда выполняющая команду переданную ей как аргумент с правами суперпользователя (root). Если быть точнее, то команда sudo позволяет выполнять программы от имени любого пользователя, но, если идентификатор или имя этого пользователя не указаны, то предполагается выполнение от имени суперпользователя root. Таким образом, использование sudo позволяет выполнять привилегированные команды обычным пользователям без необходимости ввода пароля суперпользователя root

Изменение hostname OC от имени пользователя new_user проходят при помощи команд:`sudo hostnamectl set-hostname user-1-1` и `hostnamectl`

![Image](img/16_change_root.png)
<br><br><br>

## Часть 6. Установка и настройка службы времени ##

Настройка службы времени происходит с помощью команд: `sudo timedatectl` и `timedatectl show`

![Image](img/17_settings_time.png)
<br><br><br>

## Часть 7. Установка и использование текстовых редакторов ##
Для выхода с сохранением изменений в файле test_vim.txt необходимо набрать `:wq`.

![Image](img/18_vim.png)
<br><br><br>

Для выхода с сохранением изменений в файле test_nano.txt нужно набрать `Control + x` и далее ввести `Y`.
![Image](img/20_nano.png)

Для выхода с сохранением изменений в файле test_mcedit.txt требуется нажать клавишу `F2` и подтвердить изменения.
![Image](img/21_mcedit.png)

Изменение файла test_nano.txt, с заменой ника на "21 School 21" ниже Для выхода без изменений нужно использовать сочетание клавиш `Control + x!` и далее ввести `N`

![Image](img/22_21_school_21.png)

Изменение файла test_mcedit.txt, с заменой ника на "21 School 21" представляено ниже. Для выхода без изменений нужно нажать клавишу `ESC` и не подтверждать изменения

![Image](img/23_21_school_21_mc.png)

Изменение файла test_vim.txt, с заменой ника на "21 School 21" предтавлено ниже Для выхода без изменений нужно использовать ввод `:q!`

![Image](img/24_21_school_21_vim.png)

Для поиска слова в vim нажать ESC и `/word_for_search`, где `what_for_search` то что нужно найти.

![Image](img/25_search_vim.png)

Для изменения найденного слова в vim необходиом ввести `:s/search/replace`, где `search` то что надо найти `replace` то что необходимо изменить.

![Image](img/25_replace_vim.png)

Для поиска слова в nano нужно использовать сочетание клавиш `Control + W` и далее ввести искомое слово.

![Image](img/26_search_nano.png)

Для изменения слова по поиску в nano необходимо использовать сочетание клавиш `Control + \`, далее ввести искомое слово и подтвердить изменение вводом `Y`.

![Image](img/27_replace_nano.png)

Для поиска слова в mcedit нужно нажать клавишу `F7` и ввести необходимое слово.

Для изменения слова по поиску в mcedit нужно нажать клавишу `F4` и ввести сначала слово для изменения и потом на что изменять это слово

## Часть 8. Установка и базовая настройка сервиса SSHD ##

Устанавливаем следующие службы SSHd

`sudo apt-get install ssh`

`sudo apt install openssh-server`

![Image](img/28_install_ssh.png)
![Image](img/28_install_ssh_2.png)

Добавляем автостарт службы при загрузке системы можно использовав команду:

`sudo systemctl enable ssh`

![Image](img/29_sudo_systemctl.png)

Для изменения порта необходимо изменить конфигурационный файл в текстовом редакторе по пути /etc/ssh/sshd_config. 


![Image](img/30_port_change.png)

>Команда ps вывоводит информацию об активных процессах. Флаги, которые можно использовать с ней:

* -A, -e, (a) - выбрать все процессы;
* -a - выбрать все процессы, кроме фоновых;
* -d, (g) - выбрать все процессы, даже фоновые, кроме процессов сессий;
* -N - выбрать все процессы кроме указанных;
* -С - выбирать процессы по имени команды;
* -G - выбрать процессы по ID группы;
* -p, (p) - выбрать процессы PID;
* --ppid - выбрать процессы по PID родительского процесса;
* -s - выбрать процессы по ID сессии;
* -t, (t) - выбрать процессы по tty;
* -u, (U) - выбрать процессы пользователя.

Для вывода информации о процессе SSHd можно использовать команду:

`ps -e | grep sshd`

![Image](img/31_ps_e.png)

Для применения изменений необходимо ввести команду:

`systemctl restart sshd`

![Image](img/32_system_ctl.png)

Вывод команды `netstat -tan`:

![Image](img/33_netstat.png)

>-t - Отображает только соединения TCP

>-a - Вывод всех активных подключений TCP и прослушиваемых компьютером портов TCP и UDP

>-n - Вывод активных подключений TCP с отображением адресов и номеров портов в числовом формате без попыток определения имен

>Proto: Протокол соединения

>recv-Q: Очередь получения сети

>send-Q: Сетевая очередь отправки

>Local Address: IP-адрес локального компьютера и номер используемого порта

>Foreign Address: IP-адрес и номер порта удаленного компьютера, подключенного к данному сокету

>State: Состояние TCP-соединения

>0.0.0.0: Клиентские устройства, такие как ПК, показывают адрес 0.0.0.0, когда они не подключены к какой-либо сети TCP / IP. Устройство может получить этот адрес по умолчанию, если оно не в сети. В случае сбоев назначения адреса, он может быть автоматически назначен DHCP. На случай, если ваше устройство настроено на этот адрес, оно не может общаться с любыми другими устройствами в сети через IP.

## Часть 9. Установка и использование утилит top, htop ##

Устанавливаем htop:

`sudo apt install htop`

![Image](img/34_install_htop.png)

>up - 6 min

>количество авторизованный пользователей - 1

>общая загрузка системы - 0.06, 0.32, 0.17

>общее количество процессов - 146

>загрузка cpu - 0.0

>загрузка памяти - 343.9

![Image](img/35_top.png)

Для проверки процесса занимающего больше всего памяти необходимо использовать команду:

`top -o %MEM`

![Image](img/36_top_o.png)

>pid процесса занимающего больше всего процессорного времени - 660

Сортировка по PID:

`htop --sort-key PID`